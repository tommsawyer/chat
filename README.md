# chat
анонимный чат на nodejs

запустить **npm install** для установки coffee-script и ws

запустить **node index.js** для запуска сервера


**Роутинговая система:**

Все сообщения кодируются JSONом в формате: {"type":"request_type", "data":"request_data"},
где *request_type* - тип запроса,
*request_data* - параметры запроса

Тип и дата обязательно должны присутствовать и не быть пустыми!

**Системные команды:**

*Получение списка активных клиентов -* 

запрос: {"type":"activeclients", data:"adf"}
ответ: {"type":"activeclients", data:[{id:0.123123, name:"nickname"]}
в data будет массив с объектами, в каждом из которых указан айди и никнейм активного клиента

*Смена никнейма*

запрос: {"type":"changenickname", data:"nickname"}
ответ: {"type":"changenickname"}
Сервер изменит никнейм текущего клиента на указанный в data.

**Комнаты:**

*Создание комнаты:*

запрос: {"type":"newchat","data":{"participants":[],"name":"room"}}
в participants указывается массив с клиентами, которые подключаются к комнате сразу после создания, в name - название комнаты

*Получение списка всех комнат:*
запрос: {"type":"getrooms","data":"asd"}
ответ:{"type":"getrooms","data":[{"id":0.793122100410983,"name":"room"}]}
в data массив объектов, каждый хранит айди и название комнаты

*Подключение к комнате:*

запрос: {"type":"enterroom","data":{"id":"room_id"}}
где room_id - айди комнаты, в которую входит клиент
ответ: {"type":"room","data":"Соединение с комнатой room_id установлено"}

*Получение списка активных клиентов в комнате:*

запрос: {"type":"showparticipants","data":"asd"}
ответ:{"type":"showparticipants","data":[{"id":0.4898508437909186,"name":"nickname","isOnline":true}]}

в data массив с объектами, где хранятся id клиентов, их никнеймы и флаг онлайна(хз откуда он вообще)

**Сообщения:**

*Отправление сообщения:* 

запрос: {"type":"sendmessage","data":"сообщение"}
отправляет сообщение в текущую комнату клиента, если она у него есть

*Получение сообщений:*

Если клиент находится в комнате, сервер будет присылать все сообщения, приходящие в эту комнату в виде: 
ответ:{"type":"message","data":{"message":"asdas","sender":0.20686641917563975}}

где message - само сообщение, sender - айди отправителя или его никнейм, если он указан